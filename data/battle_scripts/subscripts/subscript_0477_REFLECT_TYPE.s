.include "asm/include/battle_commands.inc"

.data

_Start:
    Call BATTLE_SUBSCRIPT_ATTACK_MESSAGE_AND_ANIMATION
    GoToIfTerastallized BATTLER_CATEGORY_DEFENDER, _ReflectTargetTeraType
    CompareMonDataToValue OPCODE_NEQ, BATTLER_CATEGORY_DEFENDER, BMON_DATA_TYPE_1, TYPE_TYPELESS, _ReflectTargetTypes
    CompareMonDataToValue OPCODE_NEQ, BATTLER_CATEGORY_DEFENDER, BMON_DATA_TYPE_2, TYPE_TYPELESS, _ReflectTargetTypes
    // Default base typing to Normal if we are reflecting a typeless Pokemon with a third type added.
    UpdateMonData OPCODE_SET, BATTLER_CATEGORY_ATTACKER, BMON_DATA_TYPE_1, TYPE_NORMAL
    UpdateMonData OPCODE_SET, BATTLER_CATEGORY_ATTACKER, BMON_DATA_TYPE_2, TYPE_NORMAL
    GoTo _ReflectTargetThirdType

_ReflectTargetTypes:
    UpdateMonDataFromVar OPCODE_GET, BATTLER_CATEGORY_DEFENDER, BMON_DATA_TYPE_1, BSCRIPT_VAR_TEMP_DATA
    UpdateMonData OPCODE_SET, BATTLER_CATEGORY_ATTACKER, BMON_DATA_TYPE_1, BSCRIPT_VAR_TEMP_DATA
    UpdateMonDataFromVar OPCODE_GET, BATTLER_CATEGORY_DEFENDER, BMON_DATA_TYPE_2, BSCRIPT_VAR_TEMP_DATA
    UpdateMonData OPCODE_SET, BATTLER_CATEGORY_ATTACKER, BMON_DATA_TYPE_2, BSCRIPT_VAR_TEMP_DATA

_ReflectTargetThirdType:
    GetThirdType BATTLER_CATEGORY_DEFENDER, BSCRIPT_VAR_TEMP_DATA
    AddThirdType BSCRIPT_VAR_TEMP_DATA
    GoTo _TypeChangeMessage

_ReflectTargetTeraType:
    GoToIfTeraType BATTLER_CATEGORY_DEFENDER, TYPE_STELLAR, _ReflectTargetTypes
    GetTeraType BATTLER_CATEGORY_DEFENDER, BSCRIPT_VAR_TEMP_DATA
    UpdateMonData OPCODE_SET, BATTLER_CATEGORY_ATTACKER, BMON_DATA_TYPE_1, BSCRIPT_VAR_TEMP_DATA
    UpdateMonData OPCODE_SET, BATTLER_CATEGORY_ATTACKER, BMON_DATA_TYPE_2, BSCRIPT_VAR_TEMP_DATA
    AddThirdType TYPE_TYPELESS
    GoTo _TypeChangeMessage 

_TypeChangeMessage:
    // {0} became the same type as {1}!
    PrintMessage 1611, TAG_NICKNAME_NICKNAME, BATTLER_CATEGORY_ATTACKER, BATTLER_CATEGORY_DEFENDER
    Wait 
    WaitButtonABTime 30
    End
