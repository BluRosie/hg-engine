.include "asm/include/battle_commands.inc"

.data

_000:
    PrintAttackMessage 
    Wait 
    UpdateMonDataFromVar OPCODE_GET, BATTLER_CATEGORY_ATTACKER, BMON_DATA_MAXHP, BSCRIPT_VAR_HP_CALC
    DivideVarByValue BSCRIPT_VAR_HP_CALC, 4
    // basically just the recover hp subscript
    UpdateMonDataFromVar OPCODE_GET, BATTLER_CATEGORY_ATTACKER, BMON_DATA_MAXHP, BSCRIPT_VAR_CALC_TEMP
    CompareMonDataToVar OPCODE_EQU, BATTLER_CATEGORY_ATTACKER, BMON_DATA_HP, BSCRIPT_VAR_CALC_TEMP, _036
    PlayMoveAnimation BATTLER_CATEGORY_ATTACKER
    Wait 
    UpdateVar OPCODE_FLAG_ON, BSCRIPT_VAR_BATTLE_STATUS, BATTLE_STATUS_NO_BLINK
    CompareVarToValue OPCODE_FLAG_NOT, BSCRIPT_VAR_BATTLE_STATUS_2, BATTLE_STATUS2_RECOVER_HP_VISUAL, _026
    PlayBattleAnimation BATTLER_CATEGORY_ATTACKER, BATTLE_ANIMATION_RESTORE_HP
    Wait 

_026:
    // update hp call but just using attacker > battler temp
    UpdateVar OPCODE_FLAG_OFF, BSCRIPT_VAR_BATTLE_STATUS, BATTLE_STATUS_NO_BLINK
    UpdateHealthBar BATTLER_CATEGORY_ATTACKER
    Wait 
    UpdateHealthBarValue BATTLER_CATEGORY_ATTACKER

    // {0} regained health!
    PrintMessage 184, TAG_NICKNAME, BATTLER_CATEGORY_ATTACKER
    Wait 
    WaitButtonABTime 30
    GoTo _ally

_036:
    WaitButtonABTime 30
    // {0}’s HP is full!
    PrintMessage 187, TAG_NICKNAME, BATTLER_CATEGORY_ATTACKER
    Wait 
    WaitButtonABTime 30

_ally:
    CompareMonDataToValue OPCODE_EQU, BATTLER_CATEGORY_ATTACKER_PARTNER, BMON_DATA_ABILITY, ABILITY_WATER_ABSORB, _absorb
    CompareMonDataToValue OPCODE_EQU, BATTLER_CATEGORY_ATTACKER_PARTNER, BMON_DATA_ABILITY, ABILITY_DRY_SKIN, _absorb
    CompareMonDataToValue OPCODE_EQU, BATTLER_CATEGORY_ATTACKER_PARTNER, BMON_DATA_ABILITY, ABILITY_STORM_DRAIN, _boost

    UpdateMonDataFromVar OPCODE_GET, BATTLER_CATEGORY_ATTACKER_PARTNER, BMON_DATA_MAXHP, BSCRIPT_VAR_HP_CALC
    DivideVarByValue BSCRIPT_VAR_HP_CALC, 4
    // basically just the recover hp subscript
    UpdateMonDataFromVar OPCODE_GET, BATTLER_CATEGORY_ATTACKER_PARTNER, BMON_DATA_MAXHP, BSCRIPT_VAR_CALC_TEMP
    CompareMonDataToVar OPCODE_EQU, BATTLER_CATEGORY_ATTACKER_PARTNER, BMON_DATA_HP, BSCRIPT_VAR_CALC_TEMP, _056
    PlayMoveAnimation BATTLER_CATEGORY_ATTACKER_PARTNER
    Wait 
    UpdateVar OPCODE_FLAG_ON, BSCRIPT_VAR_BATTLE_STATUS, BATTLE_STATUS_NO_BLINK
    CompareVarToValue OPCODE_FLAG_NOT, BSCRIPT_VAR_BATTLE_STATUS_2, BATTLE_STATUS2_RECOVER_HP_VISUAL, _046
    PlayBattleAnimation BATTLER_CATEGORY_ATTACKER_PARTNER, BATTLE_ANIMATION_RESTORE_HP
    Wait 

_046:
    // update hp call but just using attacker partner > battler temp
    UpdateVar OPCODE_FLAG_OFF, BSCRIPT_VAR_BATTLE_STATUS, BATTLE_STATUS_NO_BLINK
    UpdateHealthBar BATTLER_CATEGORY_ATTACKER_PARTNER
    Wait 
    UpdateHealthBarValue BATTLER_CATEGORY_ATTACKER_PARTNER
    
    // {0} regained health!
    PrintMessage 184, TAG_NICKNAME, BATTLER_CATEGORY_ATTACKER_PARTNER
    Wait 
    WaitButtonABTime 30
    GoTo _end

_056:
    WaitButtonABTime 30
    // {0}’s HP is full!
    PrintMessage 187, TAG_NICKNAME, BATTLER_CATEGORY_ATTACKER_PARTNER
    Wait 
    WaitButtonABTime 30
    GoTo _end

_absorb:
    UpdateMonDataFromVar OPCODE_GET, BATTLER_CATEGORY_ATTACKER_PARTNER, BMON_DATA_MAXHP, BSCRIPT_VAR_CALC_TEMP
    CompareMonDataToVar OPCODE_EQU, BATTLER_CATEGORY_ATTACKER_PARTNER, BMON_DATA_HP, BSCRIPT_VAR_CALC_TEMP, _useless

    UpdateMonDataFromVar OPCODE_GET, BATTLER_CATEGORY_ATTACKER_PARTNER, BMON_DATA_MAXHP, BSCRIPT_VAR_HP_CALC
    DivideVarByValue BSCRIPT_VAR_HP_CALC, 4
    // update hp call but just using attacker partner > battler temp
    UpdateVar OPCODE_FLAG_OFF, BSCRIPT_VAR_BATTLE_STATUS, BATTLE_STATUS_NO_BLINK
    UpdateHealthBar BATTLER_CATEGORY_ATTACKER_PARTNER
    Wait 
    UpdateHealthBarValue BATTLER_CATEGORY_ATTACKER_PARTNER
    // {0} regained health!
    PrintMessage 184, TAG_NICKNAME, BATTLER_CATEGORY_ATTACKER_PARTNER
    Wait 
    WaitButtonABTime 30
    GoTo _end

_boost:
    CompareMonDataToValue OPCODE_EQU, BATTLER_CATEGORY_ATTACKER_PARTNER, BMON_DATA_STAT_CHANGE_SPATK, 12, _useless
    PlayBattleAnimation BATTLER_CATEGORY_ATTACKER_PARTNER, BATTLE_ANIMATION_STAT_BOOST
    Wait 
    UpdateMonData OPCODE_ADD, BATTLER_CATEGORY_ATTACKER_PARTNER, BMON_DATA_STAT_CHANGE_SPATK, 1
    UpdateVar OPCODE_SET, BSCRIPT_VAR_MESSAGE, 4
    // {0}’s {1} raised its {2}!
    PrintMessage 622, TAG_NICKNAME_ABILITY_STAT, BATTLER_CATEGORY_MSG_TEMP, BATTLER_CATEGORY_MSG_TEMP, BATTLER_CATEGORY_MSG_TEMP
    Wait 
    WaitButtonABTime 30
    GoTo _end
    
_useless:
    // {0}’s {1} made {2} useless!
    PrintMessage 638, TAG_NICKNAME_ABILITY_MOVE, BATTLER_CATEGORY_ATTACKER_PARTNER, BATTLER_CATEGORY_ATTACKER_PARTNER, BATTLER_CATEGORY_ATTACKER
    Wait 
    WaitButtonABTime 30

_end:
    UpdateVar OPCODE_FLAG_ON, BSCRIPT_VAR_MOVE_STATUS_FLAGS, MOVE_STATUS_NO_MORE_WORK 
    End
